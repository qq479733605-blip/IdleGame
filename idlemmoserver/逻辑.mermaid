%% ä¿®ä»™æ”¾ç½®MMOæœåŠ¡ç«¯ - é€»è¾‘åˆ†å±‚æ¶æ„å›¾
graph TD
%% === å¤–éƒ¨æ¥å£å±‚ ===
subgraph InterfaceLayer["ğŸŒ æ¥å£å±‚ï¼ˆInterface Layerï¼‰"]
A1[HTTP ç™»å½•æ¥å£<br>Gin]
A2[WebSocket æœåŠ¡<br> Gorilla]
end

%% === Actor å±‚ ===
subgraph ActorLayer["ğŸ­ Actor å±‚ï¼ˆActor Layer, protoactor-goï¼‰"]
B1[GatewayActor<br>è¿æ¥ç®¡ç†ä¸æ¶ˆæ¯è·¯ç”±]
B2[PlayerActor<br>ç©å®¶èšåˆæ ¹,æŒæœ‰æ‰€æœ‰çŠ¶æ€]
B3[SequenceActor<br>å•ä¸ªä¿®ç‚¼åºåˆ—ï¼ˆé‡‡é›†/æ‰“å/ç‚¼ä¸¹ï¼‰]
B4[SchedulerActor<br>ç»Ÿä¸€ Tick è°ƒåº¦]
B5[PersistActor<br>å¼‚æ­¥æŒä¹…åŒ–é˜Ÿåˆ—]
B6[TeamActor<br>ç»„é˜Ÿé€»è¾‘ï¼ˆæ‰©å±•ï¼‰]
B7[WorldActor<br>æ’è¡Œæ¦œ/æ´»åŠ¨ç³»ç»Ÿï¼ˆæ‰©å±•ï¼‰]
end

%% === é¢†åŸŸå±‚ ===
subgraph DomainLayer["ğŸ“š é¢†åŸŸå±‚ï¼ˆDomain Layerï¼‰"]
C1[domain.Player<br>ç©å®¶é¢†åŸŸå¯¹è±¡]
C2[domain.Sequence<br>ä¿®ç‚¼åºåˆ—è§„åˆ™]
C3[domain.Formula<br>äº§å‡ºä¸æˆé•¿æ›²çº¿]
C4[domain.Items<br>ç‰©å“ä¸èµ„æºå®šä¹‰]
end

%% === æŒä¹…å±‚ ===
subgraph PersistLayer["ğŸ’¾ æŒä¹…å±‚ï¼ˆPersistence Layerï¼‰"]
D1[Repository Interface<br>å­˜å‚¨æ¥å£æŠ½è±¡]
D2[Redis / Postgres / JSON Snapshot]
end

%% === å±‚å†…å…³ç³» ===
A1 --> B1
A2 --> B1
B1 --> B2
B2 --> B3
B4 --> B3
B3 --> B2
B2 --> B5
B5 --> D1
D1 --> D2

%% Domain interactions
B2 --> C1
B3 --> C2
C2 --> C3
C1 --> C4

%% Optional extensions
B2 --> B6
B2 --> B7
B6 --> B3
B7 --> B5

%% Annotations
classDef layer fill:#2b2b2b,stroke:#777,color:#fff,stroke-width:1px;
classDef actor fill:#32394a,stroke:#888,color:#fff,stroke-width:1px;
classDef domain fill:#2e463d,stroke:#888,color:#fff,stroke-width:1px;
classDef persist fill:#383838,stroke:#888,color:#fff,stroke-width:1px;

class InterfaceLayer,ActorLayer,DomainLayer,PersistLayer layer;
class B1,B2,B3,B4,B5,B6,B7 actor;
class C1,C2,C3,C4 domain;
class D1,D2 persist;
