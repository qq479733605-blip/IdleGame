sequenceDiagram
    participant WS as WebSocket
    participant Gateway as GatewayActor
    participant Player as PlayerActor
    participant Persist as PersistActor

    WS->>Gateway: C_Login
    Gateway->>Player: MsgPlayerReconnect or spawn
    Player-->>WS: S_ReconnectOK

WS--X Player: WebSocket Closed
Gateway->>Player: MsgPlayerOffline
Note right of Player: 离线结算中（不发UI）

loop 每分钟
Persist->>Player: MsgCheckExpire
alt 超出离线时长
Player->>Persist: MsgSavePlayer
Player->>Player: ctx.Stop()
end
end
