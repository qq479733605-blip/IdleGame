<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Connection Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>

    <script>
        const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NjE2NTc1MjksImlhdCI6MTc2MTU3MTEyOSwicGxheWVySUQiOiI4Y2ViNGY5ZDBhYzk2ODdmIn0.h-cVbNWRv5q3helohG-jkG4XnZ5lOwKcXEVLxJSgmiA";
        const ws = new WebSocket(`ws://localhost:8002/ws?token=${token}`);

        const status = document.getElementById('status');
        const messages = document.getElementById('messages');

        function addMessage(msg) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + msg;
            messages.appendChild(div);
        }

        ws.onopen = function(event) {
            status.textContent = 'Connected';
            addMessage('WebSocket connected');

            // Send login message
            ws.send(JSON.stringify({ type: 'C_Login', token: token }));
            addMessage('Sent login message');

            // Start ping interval
            setInterval(() => {
                if (ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({ type: 'C_Ping' }));
                    addMessage('Sent ping');
                }
            }, 10000); // Send ping every 10 seconds for testing
        };

        ws.onmessage = function(event) {
            const msg = JSON.parse(event.data);

            if (msg.type === 'S_Pong') {
                addMessage('Received pong response');
            } else if (msg.type === 'S_LoginOK') {
                addMessage('Login successful: ' + JSON.stringify(msg));
            } else {
                addMessage('Received message: ' + JSON.stringify(msg));
            }
        };

        ws.onclose = function(event) {
            status.textContent = 'Disconnected';
            addMessage('WebSocket closed: ' + event.code + ' - ' + event.reason);
        };

        ws.onerror = function(error) {
            addMessage('WebSocket error: ' + error);
        };
    </script>
</body>
</html>